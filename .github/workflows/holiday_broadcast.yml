name: Xiaoyun Holiday Broadcast

on:
  schedule:
    # ======================================================================
    #                 å°é›²çš„ç¯€æ—¥å»£æ’­é¬§é˜ (ä½¿ç”¨ UTC æ™‚é–“)
    #  æ‰€æœ‰æ™‚é–“çš†å·²è½‰æ›ç‚º UTCã€‚è¨»è§£ä¸­æœƒæ¨™ç¤ºå°æ‡‰çš„ UTC+8 æ™‚é–“ (å°ç£/å‰éš†å¡)ã€‚
    #  æ ¼å¼: cron: 'åˆ†é˜ å°æ™‚ æ—¥ æœˆ æ˜ŸæœŸå¹¾'
    # ======================================================================

    # -------------------------
    # --- 1. é€šç”¨å‚³çµ±ç¯€æ—¥ ---
    # -------------------------
    # å…ƒæ—¦ (æ¯å¹´ 1æœˆ1æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 1 1 *'
    # è¾²æ›†é™¤å¤• (2025å¹´1æœˆ28æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00) - éœ€æ‰‹å‹•æ›´æ–°å¹´ä»½
    - cron: '0 1 28 1 *'
    # è¾²æ›†æ–°å¹´/å¤§å¹´åˆä¸€ (2025å¹´1æœˆ29æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00) - éœ€æ‰‹å‹•æ›´æ–°å¹´ä»½
    - cron: '0 1 29 1 *'
    # è¥¿æ´‹æƒ…äººç¯€ (æ¯å¹´ 2æœˆ14æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 14 2 *'
    # å…ƒå®µç¯€ (2025å¹´2æœˆ12æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00) - éœ€æ‰‹å‹•æ›´æ–°å¹´ä»½
    - cron: '0 1 12 2 *'
    # ç«¯åˆç¯€ (2025å¹´5æœˆ31æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00) - éœ€æ‰‹å‹•æ›´æ–°å¹´ä»½
    - cron: '0 1 31 5 *'
    # ä¸ƒå¤•æƒ…äººç¯€ (2024å¹´8æœˆ10æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00) - éœ€æ‰‹å‹•æ›´æ–°å¹´ä»½
    - cron: '0 1 10 8 *'
    # ä¸­ç§‹ç¯€ (2024å¹´9æœˆ17æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00) - éœ€æ‰‹å‹•æ›´æ–°å¹´ä»½
    - cron: '0 1 17 9 *'
    # è–èª•å¤œ (æ¯å¹´ 12æœˆ24æ—¥, UTC+8 æ™šä¸Š 8:00 -> UTC 12:00)
    - cron: '0 12 24 12 *'
    # è–èª•ç¯€ (æ¯å¹´ 12æœˆ25æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 25 12 *'
    # è·¨å¹´å¤œ (æ¯å¹´ 12æœˆ31æ—¥, UTC+8 æ™šä¸Š 11:00 -> UTC 15:00)
    - cron: '0 15 31 12 *'

    # -------------------------
    # --- 2. ç¶²è·¯/æœ‰è¶£ç¯€æ—¥ ---
    # -------------------------
    # åœ‹éš›éº»ç³¬æ—¥ (æ¯å¹´ 1æœˆ3æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 3 1 *'
    # åœ‹éš›çˆ†ç±³èŠ±æ—¥ (æ¯å¹´ 1æœˆ19æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 19 1 *'
    # ä¸–ç•Œç¡çœ æ—¥ (æ¯å¹´ 3æœˆæ˜¥åˆ†å‰çš„æ˜ŸæœŸäº”, UTC+8 æ—©ä¸Š 10:00 -> UTC 02:00)
    - cron: '0 2 15 3 *' # 2024/3/15
    - cron: '0 2 21 3 *' # 2025/3/21
    # åœ‹éš›æ•é ­å¤§æˆ°æ—¥ (æ¯å¹´ 4æœˆç¬¬ä¸€å€‹æ˜ŸæœŸå…­, UTC+8 æ—©ä¸Š 10:00 -> UTC 02:00)
    - cron: '0 2 * 4 6'
    # æ˜Ÿéš›å¤§æˆ°æ—¥ (æ¯å¹´ 5æœˆ4æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 4 5 *'
    # ä¸–ç•Œ emoji æ—¥ (æ¯å¹´ 7æœˆ17æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 17 7 *'
    # åœ‹éš›æ‡¶æƒ°æ—¥ (æ¯å¹´ 8æœˆ10æ—¥, UTC+8 æ—©ä¸Š 10:00 -> UTC 02:00)
    - cron: '0 2 10 8 *'
    # åœ‹éš›åŸ¹æ ¹æ—¥ (æ¯å¹´ 9æœˆç¬¬ä¸€å€‹æ˜ŸæœŸå…­, UTC+8 æ—©ä¸Š 10:00 -> UTC 02:00)
    - cron: '0 2 * 9 6'
    # åƒæµ·ç›œä¸€æ¨£èªªè©±æ—¥ (æ¯å¹´ 9æœˆ19æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 19 9 *'
    # è¬è–å¤œ (æ¯å¹´ 10æœˆ31æ—¥, UTC+8 æ™šä¸Š 7:00 -> UTC 11:00)
    - cron: '0 11 31 10 *'

    # -------------------------
    # --- 3. è²“å’ªç›¸é—œç¯€æ—¥ ---
    # -------------------------
    # è²“ä¹‹æ—¥ (æ—¥æœ¬) (æ¯å¹´ 2æœˆ22æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 22 2 *'
    # åœ‹éš›æµªæµªæ—¥ (æ¯å¹´ 4æœˆ4æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 4 4 *'
    # ä¸–ç•Œç¸é†«æ—¥ (æ¯å¹´ 4æœˆæœ€å¾Œä¸€å€‹æ˜ŸæœŸå…­, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 * 4 6'
    # æ“æŠ±ä½ çš„è²“æ—¥ (æ¯å¹´ 6æœˆ4æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 4 6 *'
    # åœ‹éš›è²“å’ªæ—¥ (æ¯å¹´ 8æœˆ8æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 8 8 *'
    # åœ‹éš›é»‘è²“æ—¥ (æ¯å¹´ 8æœˆ17æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 17 8 *'
    # è–‘é»ƒè²“æ„Ÿè¬æ—¥ (æ¯å¹´ 9æœˆ1æ—¥, UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 1 9 *'
    # è³“å£«è²“æ—¥ (æ¯å¹´ 10æœˆ1æ—¥, å°é›²çš„ä¸»å ´ï¼ UTC+8 æ—©ä¸Š 9:00 -> UTC 01:00)
    - cron: '0 1 1 10 *'
    
  workflow_dispatch:
    inputs:
      event_override:
        description: 'æ‰‹å‹•æ¸¬è©¦ï¼šè¼¸å…¥ç¯€æ—¥åç¨±'
        required: true
        default: 'ä¸€å€‹å¿«æ¨‚çš„æ¸¬è©¦æ—¥'

jobs:
  broadcast-holiday-message:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Determine Event and Run Script
        env:
          LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          EVENT_NAME_TO_RUN=""
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            EVENT_NAME_TO_RUN="${{ github.event.inputs.event_override }}"
          else
            UTC_DATE=$(date -u +'%m-%d')
            UTC_FULL_DATE=$(date -u +'%Y-%m-%d')
            UTC_DAY_OF_WEEK=$(date -u +'%u')

            # --- é€šç”¨å‚³çµ±ç¯€æ—¥ ---
            if [[ "$UTC_DATE" == '01-01' ]]; then EVENT_NAME_TO_RUN="å…ƒæ—¦æ–°å¹´"; fi
            if [[ "$UTC_FULL_DATE" == '2025-01-28' ]]; then EVENT_NAME_TO_RUN="è¾²æ›†é™¤å¤•å¤œ"; fi
            if [[ "$UTC_FULL_DATE" == '2025-01-29' ]]; then EVENT_NAME_TO_RUN="è¾²æ›†æ–°å¹´"; fi
            if [[ "$UTC_DATE" == '02-14' ]]; then EVENT_NAME_TO_RUN="è¥¿æ´‹æƒ…äººç¯€"; fi
            if [[ "$UTC_FULL_DATE" == '2025-02-12' ]]; then EVENT_NAME_TO_RUN="å…ƒå®µç¯€"; fi
            if [[ "$UTC_FULL_DATE" == '2025-05-31' ]]; then EVENT_NAME_TO_RUN="ç«¯åˆç¯€"; fi
            if [[ "$UTC_FULL_DATE" == '2024-08-10' ]]; then EVENT_NAME_TO_RUN="ä¸ƒå¤•æƒ…äººç¯€"; fi
            if [[ "$UTC_FULL_DATE" == '2024-09-17' ]]; then EVENT_NAME_TO_RUN="ä¸­ç§‹ç¯€"; fi
            if [[ "$UTC_DATE" == '12-24' ]]; then EVENT_NAME_TO_RUN="è–èª•å¤œ"; fi
            if [[ "$UTC_DATE" == '12-25' ]]; then EVENT_NAME_TO_RUN="è–èª•ç¯€"; fi
            if [[ "$UTC_DATE" == '12-31' ]]; then EVENT_NAME_TO_RUN="è·¨å¹´å¤œ"; fi

            # --- ç¶²è·¯/æœ‰è¶£ç¯€æ—¥ ---
            if [[ "$UTC_DATE" == '01-03' ]]; then EVENT_NAME_TO_RUN="åœ‹éš›éº»ç³¬æ—¥"; fi
            if [[ "$UTC_DATE" == '01-19' ]]; then EVENT_NAME_TO_RUN="åœ‹éš›çˆ†ç±³èŠ±æ—¥"; fi
            if [[ $(date -u +'%Y') == '2024' && "$UTC_DATE" == '03-15' ]]; then EVENT_NAME_TO_RUN="ä¸–ç•Œç¡çœ æ—¥"; fi
            if [[ $(date -u +'%Y') == '2025' && "$UTC_DATE" == '03-21' ]]; then EVENT_NAME_TO_RUN="ä¸–ç•Œç¡çœ æ—¥"; fi
            if [[ $(date -u +'%m') == '04' && $UTC_DAY_OF_WEEK == '6' && $(date -u +'%d') -le 7 ]]; then EVENT_NAME_TO_RUN="åœ‹éš›æ•é ­å¤§æˆ°æ—¥"; fi
            if [[ "$UTC_DATE" == '05-04' ]]; then EVENT_NAME_TO_RUN="æ˜Ÿéš›å¤§æˆ°æ—¥"; fi
            if [[ "$UTC_DATE" == '07-17' ]]; then EVENT_NAME_TO_RUN="ä¸–ç•ŒEmojiæ—¥"; fi
            if [[ "$UTC_DATE" == '08-10' ]]; then EVENT_NAME_TO_RUN="åœ‹éš›æ‡¶æƒ°æ—¥"; fi
            if [[ $(date -u +'%m') == '09' && $UTC_DAY_OF_WEEK == '6' && $(date -u +'%d') -le 7 ]]; then EVENT_NAME_TO_RUN="åœ‹éš›åŸ¹æ ¹æ—¥"; fi
            if [[ "$UTC_DATE" == '09-19' ]]; then EVENT_NAME_TO_RUN="åƒæµ·ç›œä¸€æ¨£èªªè©±æ—¥"; fi
            if [[ "$UTC_DATE" == '10-31' ]]; then EVENT_NAME_TO_RUN="è¬è–å¤œ"; fi

            # --- è²“å’ªç›¸é—œç¯€æ—¥ ---
            if [[ "$UTC_DATE" == '02-22' ]]; then EVENT_NAME_TO_RUN="è²“ä¹‹æ—¥"; fi
            if [[ "$UTC_DATE" == '04-04' ]]; then EVENT_NAME_TO_RUN="åœ‹éš›æµªæµªæ—¥"; fi
            if [[ $(date -u +'%m') == '04' && $UTC_DAY_OF_WEEK == '6' && $(date -u +'%d') -gt 23 ]]; then EVENT_NAME_TO_RUN="ä¸–ç•Œç¸é†«æ—¥"; fi
            if [[ "$UTC_DATE" == '06-04' ]]; then EVENT_NAME_TO_RUN="æ“æŠ±ä½ çš„è²“æ—¥"; fi
            if [[ "$UTC_DATE" == '08-08' ]]; then EVENT_NAME_TO_RUN="åœ‹éš›è²“å’ªæ—¥"; fi
            if [[ "$UTC_DATE" == '08-17' ]]; then EVENT_NAME_TO_RUN="åœ‹éš›é»‘è²“æ—¥"; fi
            if [[ "$UTC_DATE" == '09-01' ]]; then EVENT_NAME_TO_RUN="è–‘é»ƒè²“æ„Ÿè¬æ—¥"; fi
            if [[ "$UTC_DATE" == '10-01' ]]; then EVENT_NAME_TO_RUN="è³“å£«è²“æ—¥"; fi
          fi

          if [[ -n "$EVENT_NAME_TO_RUN" ]]; then
            echo "ğŸ‰ Detected event: $EVENT_NAME_TO_RUN"
            EVENT_NAME="$EVENT_NAME_TO_RUN" python holiday_broadcast.py
          else
            echo "No scheduled event for today. Skipping."
          fi
